<div class="rk-base-card">
  <div class="card-item">
    <div class="container-fluid">
      <div class="row">
        <div class="col-12 p-0 d-flex align-items-center justify-content-between">
          <h5 class="page-title">{{'PublicIp'|translate}}</h5>

          <button class="btn btn-icon btn-small ml-2" (click)="showNewIpForm()">
            <i-feather name="plus"></i-feather>
            {{'AddNewIp'|translate}}
          </button>
        </div>

        <rk-modal #agentModal>
          <rk-modal-header icon="plus">
            <rk-modal-header-title>
              <h5>{{'CreateNewAgent'|translate}}</h5>
            </rk-modal-header-title>
            <rk-modal-header-close (click)="agentModal.toggle()"></rk-modal-header-close>
          </rk-modal-header>

          <rk-modal-body>
            <form [formGroup]="publicIpForm" class="publicIpForm">
              <div class="container-fluid">
                <div class="row">
                  <div class="col-6">
                    <rk-radio name="ipType" (valueChange)="onSelectionChangeIPType('staticIp')"
                      [checked]="ipType == 'staticIp'">{{'StaticIp'|translate}}</rk-radio>
                  </div>
                  <div class="col-6">
                    <rk-radio name="ipType" (valueChange)="onSelectionChangeIPType('dynamicIp')"
                      [checked]="ipType == 'dynamicIp'">{{'DynamicIp'|translate}}</rk-radio>
                  </div>
                </div>

                <div class="row mt-2 mb-1">
                  <div class="col-12 d-flex justify-content-center">
                    <input type="file" class="input-file" id="fileUpload" (change)="selectFile($event)"
                      accept="image/*">
                    <label for="fileUpload" class="mx-auto d-flex flex-column align-items-center">
                      <figure>
                        <ng-container *ngIf="selectedIp.logo; else elseTemplateLogo">
                          <img src="{{ selectedIp.logo }}" class="w-100" accept="image/png, image/jpeg">
                        </ng-container>
                        <ng-template #elseTemplateLogo>
                          <div class="file-upload mx-auto">
                            <i-feather name="plus"></i-feather>
                          </div>
                        </ng-template>
                      </figure>
                      <span class="file-upload-text">{{'BlockPageLogo'|translate}}</span>
                    </label>
                  </div>
                </div>

                <div class="row">
                  <div class="col-12">
                    <input type="text" class="rk-input w-100" placeholder="{{'Name'|translate}}" name="agentName" id="agentName"
                      [(ngModel)]="selectedIp.agentAlias" formControlName="agentName" maxlength="64">
                  </div>

                  <ng-container *ngIf="ipType == 'dynamicIp'; else elseTemplateIpType">
                    <div id="dnsFqnDiv" name="dnsFqnDiv" class="col-12 mt-2">
                      <input type="text" id="dnsFqdn" name="dnsFqdn" class="rk-input w-100"
                        [(ngModel)]="selectedIp.dynamicIpDomain" formControlName="dnsFqdn" placeholder="{{'DNSFQDN'|translate}}">
                    </div>
                  </ng-container>

                  <ng-template #elseTemplateIpType>
                    <div class="col-12 d-flex mt-2" *ngFor="let row of selectedIp.staticSubnetIp; index as i">
                      <div class="rk-input-container">
                        <span style="flex: 2">
                          <input type="text" placeholder="{{'IP'|translate}}" maxlength="15" name="'ip'+i"
                            (keydown)="checkIPNumber($event, selectedIp.staticSubnetIp[i].baseIp)"
                            [(ngModel)]="selectedIp.staticSubnetIp[i].baseIp" [ngModelOptions]="{standalone: true}">
                          /
                        </span>

                        <rk-select [placeholder]="selectedIp.staticSubnetIp[i].mask" [options]="ipRanges"
                          [(value)]="selectedIp.staticSubnetIp[i].mask">
                        </rk-select>
                      </div>

                      <ng-container *ngIf="i > 0; else elseTemplate11">
                        <button class="btn btn-icon p-0 px-2 ml-1" (click)="removeElementFromIpList(i)">
                          <i-feather name="trash-2" class="mr-0 fill-red"></i-feather>
                        </button>
                      </ng-container>

                      <ng-template #elseTemplate11>
                        <button class="btn btn-icon bg-primary fill-white p-0 px-2 ml-1" (click)="addIpRangeToList()">
                          <i-feather name="plus" class="mr-0"></i-feather>
                        </button>
                      </ng-template>
                    </div>
                  </ng-template>

                  <div class="col-12 mt-2">
                    <rk-select [options]="securityProfilesForRkSelect" placeholder="{{'SelectProfile'|translate}}"
                      (valueChange)="securityProfileChanged($event)">
                    </rk-select>
                  </div>

                  <div class="col-12 mt-2">
                    <textarea class="rk-input textarea w-100 resize:none" name="blockMessage" id="blockMessage"
                      [(ngModel)]="selectedIp.blockMessage" placeholder="{{'BlockMessage'|translate}}" rows="4"
                      [ngModelOptions]="{standalone: true}"></textarea>
                  </div>

                  <div class="col-12 mt-2">
                    <input type="text" class="rk-input w-100" placeholder="{{'SinkHoleIp'|translate}}"
                      (keydown)="checkIPNumber($event, selectedIp.cyberXRayIp)" [(ngModel)]="selectedIp.cyberXRayIp"
                      [ngModelOptions]="{standalone: true}">
                  </div>
                </div>
              </div>
            </form>

          </rk-modal-body>

          <rk-modal-footer>
            <button class="btn w-100 btn-small mr-2" id="defaultSaveBtn" [disabled]="!isNewItemUpdated"
              (click)="savePublicIp()">{{'Apply'|translate}}</button>
            <button class="btn w-100 btn-default btn-small" (click)="agentModal.toggle()">{{'Close'|translate}}</button>
          </rk-modal-footer>
        </rk-modal>

        <rk-modal #profileModal>
          <rk-modal-header>
            <rk-modal-header-title>
              <h5>{{'SecurityProfile'|translate}}</h5>
            </rk-modal-header-title>
            <rk-modal-header-close (click)="profileModal.toggle()"></rk-modal-header-close>
          </rk-modal-header>

          <rk-modal-body>

            <app-profile-wizard #profileWizard [selectedAgent]="selectedAgent" [currentStep]="currentStep"
              [saveMode]="saveMode"></app-profile-wizard>

          </rk-modal-body>

          <rk-modal-footer>
            <button class="btn w-100 btn-small mr-2" (click)="saveProfile()">{{'Save'|translate}}</button>
            <button class="btn w-100 btn-small" (click)="nextStep()">{{'Next'|translate}}</button>
          </rk-modal-footer>
        </rk-modal>

        <div class="col-12 p-0 mt-3">
          <rk-table-container class="m-0">
            <div class="rk-table-container-header">
              <div class="top-content justify-content-start">
                <div class="inf mr-4">
                  <span class="text-primary">{{ publicIpsFiltered.length }}</span> {{'QueriesListed'|translate}}
                </div>

                <div class="search ml-5">
                  <div class="rk-autocomplete-container" style="width: 220px;">
                    <input type="text" placeholder="{{'Search'|translate}}" [(ngModel)]="searchKey" class="rk-input rk-autocomplete">
                    <i-feather class="search-icon" name="search"></i-feather>
                  </div>
                </div>
              </div>
            </div>

            <rk-table [showPagination]="false">
              <ng-template #header>
                <tr>
                  <th class="index">#</th>
                  <th>{{'Name'|translate}}</th>
                  <th>{{'IpType'|translate}}</th>
                  <th>{{'IpAddressDomain'|translate}}</th>
                  <th>{{'SecurityProfile'|translate}}</th>
                  <th style="width: 85px;">{{'Operation'|translate}}</th>
                </tr>
              </ng-template>

              <ng-template #body>
                <tr *ngFor="let pi of publicIpsFiltered |Â filter: searchKey : 'agentAlias'; let i = index ">
                  <td class=" index">{{ i+1 }}</td>
                  <td>
                    <div class="d-flex align-items-center justify-content-between">
                      <span>{{ pi.agentAlias }}</span>
                      <button class="btn btn-link btn-icon p-0 hover-gray" (click)="showEditWizard(pi.id)">
                        <i-feather name="settings" class="mr-0"></i-feather>
                      </button>
                    </div>
                  </td>
                  <td>
                    <ng-container *ngIf="pi.staticSubnetIp && pi.staticSubnetIp.length > 0; else elseTemplateIpType2">
                      {{'Static'|translate}}
                    </ng-container>
                    <ng-template #elseTemplateIpType2>
                      {{'Dynamic'|translate}}
                    </ng-template>
                  </td>
                  <td>
                    <div *ngIf="pi.staticSubnetIp && pi.staticSubnetIp.length > 0">
                      <div *ngFor="let pis of pi.staticSubnetIp">[{{pis.baseIp}}]/[{{pis.mask}}] </div>
                    </div>
                    <div *ngIf="!pi.staticSubnetIp && pi.dynamicIpDomain">
                      [{{pi.dynamicIpDomain}}]
                    </div>
                  </td>
                  <td>
                    <div class="d-flex align-items-center justify-content-between">
                      <span>{{ pi.rootProfile?pi.rootProfile.name: 'No Profile!' }}</span>

                      <button class="btn btn-link btn-icon p-0 hover-gray" (click)="showProfileEditWizard(pi.id)">
                        <i-feather name="settings" class="mr-0"></i-feather>
                      </button>
                    </div>
                  </td>
                  <td class="text-center">
                    <button class="btn btn-link btn-icon p-0 hover-gray" (click)="deletePublicIp(pi.id)">
                      <i-feather name="trash-2" class="mr-0"></i-feather>
                    </button>
                  </td>
                </tr>
                <tr *ngIf="publicIpsFiltered == null || publicIpsFiltered.length < 1">
                  <td></td>
                  <td colspan="10">{{'NoData'|translate}}</td>
                </tr>
              </ng-template>
            </rk-table>
          </rk-table-container>
        </div>
      </div>
    </div>
  </div>
</div>