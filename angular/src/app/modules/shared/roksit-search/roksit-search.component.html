<rk-modal #saveModal>
  <rk-modal-header>
    <rk-modal-header-title>
      <h5>{{ 'REPORT.SaveReport' | translate }}</h5>
    </rk-modal-header-title>

    <rk-modal-header-close (click)="saveModal.toggle()"></rk-modal-header-close>
  </rk-modal-header>

  <rk-modal-body>

    <div class="container-fluid mb-2">
      <div class="row">
        <div class="col-12">
          <div class="rk-tabs">
            <div class="rk-tab" (click)="setReportActiveTabNumber(0); prepareNewSaveFilter()"
              [ngClass]="{'active': reportActiveTabNumber === 0}">{{ 'REPORT.NewReport' | translate }}</div>
            <div class="rk-tab" (click)="setReportActiveTabNumber(1)"
              [ngClass]="{'active': reportActiveTabNumber === 1}">{{ 'REPORT.UpdateReport' | translate }}</div>
          </div>
        </div>
      </div>
    </div>

    <div class="container-fluid" *ngIf="reportActiveTabNumber === 0">
      <div class="row">
        <div class="col-12">
          <div class="rk-title">{{ 'REPORT.ReportName' | translate }}</div>

          <input type="text" class="rk-input w-100 mt-1" placeholder="Filter Name" [(ngModel)]="newSavedReport.name">
        </div>

        <div class="col-12 mt-3">
          <div class="rk-title">{{ 'REPORT.ScheduleReportSendToEmail' | translate }}</div>
          <div class="mt-2">
            <rk-radio class="rk-radio-m-0" (valueChange)="changeSavedReportType($event)" name="savedReportFilter"
              value="all">
              {{ 'All' | translate }}
            </rk-radio>
          </div>
          <div class="mt-2">
            <rk-radio class="rk-radio-m-0" (valueChange)="changeSavedReportType($event)" name="savedReportFilter"
              value="d">
              {{ 'REPORT.ScheduleDailyReportEmail' | translate }}
            </rk-radio>
          </div>
          <div class="mt-2">
            <rk-radio class="rk-radio-m-0" (valueChange)="changeSavedReportType($event)" name="savedReportFilter"
              value="w">
              {{ 'REPORT.ScheduleWeeklyReportEmail' | translate }}
            </rk-radio>
          </div>
          <div class="mt-2">
            <rk-radio class="rk-radio-m-0" (valueChange)="changeSavedReportType($event)" name="savedReportFilter"
              value="m">
              {{ 'REPORT.ScheduleMontlyReportEmail' | translate }}
            </rk-radio>
          </div>
        </div>

        <!-- <div class="col-12 mt-3" *ngIf="newSavedReport?.scheduledReport !== 'all'">
          <div class="rk-title">Users</div>

          <div class="rk-modal-item p-0" style="height: 1px; border-bottom: none;">
            <div class="rk-category-container mt-3">
              <div class="category-header category-item">
                <rk-checkbox class="checkbox" alignment="right" size="sm" className="m-0"
                  (valueChange)="toggleAllUsers($event)">
                  All Users
                </rk-checkbox>
              </div>

              <div class="category-body">
                <div class="category-item" *ngFor="let user of users">
                  <rk-checkbox size="sm" alignment="right" [(value)]="user.selected">{{ user.username }}</rk-checkbox>
                </div>
              </div>
            </div>
          </div>
        </div> -->
      </div>
    </div>

    <div class="container-fluid" *ngIf="reportActiveTabNumber === 1">
      <div class="row">
        <div class="col-12">
          <rk-select [options]="savedReportOptions" (valueChange)="savedReportSelectChanged($event)"></rk-select>
        </div>
      </div>
    </div>

  </rk-modal-body>

  <rk-modal-footer>
    <button class="btn btn-small w-100 mr-2" (click)="saveReport()"> {{ 'Save' | translate }}</button>
    <button class="btn btn-small btn-default w-100" (click)="saveModal.toggle()"> {{ 'Cancel' | translate }}</button>
  </rk-modal-footer>
</rk-modal>

<rk-modal #modal>
  <rk-modal-header icon="filter">
    <rk-modal-header-title>
      <h5> {{ 'REPORT.Filters' | translate }}</h5>
    </rk-modal-header-title>
    <rk-modal-header-close (click)="modal.toggle()"></rk-modal-header-close>
  </rk-modal-header>

  <rk-modal-body>

    <div class="container-fluid">
      <div class="row">
        <div class="col-12">
          <div class="rk-tabs">
            <div class="rk-tab" (click)="setActiveTabNumber(0)" [ngClass]="{'active': activeTabNumber === 0}"> {{ 'REPORT.NewReports' | translate }}</div>
            <div class="rk-tab" (click)="setActiveTabNumber(1)" [ngClass]="{'active': activeTabNumber === 1}"> {{ 'REPORT.SavedReports' | translate }}</div>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="activeTabNumber === 0">
      <div class="rk-modal-item">
        <h5 class="modal-item title"> {{ 'REPORT.Action' | translate }}</h5>

        <div class="container-fluid">
          <div class="row">
            <div class="col-12 col-md-6">
              <rk-radio name="actionType" class="rk-radio-m-0" [checked]="actionType === 'allow'" value="allow"
                (valueChange)="actionChanged($event)"> {{ 'REPORT.Allow' | translate }}</rk-radio>
            </div>
            <div class="col-12 col-md-6">
              <rk-radio name="actionType" class="rk-radio-m-0" [checked]="actionType === 'deny'" value="deny"
                (valueChange)="actionChanged($event)"> {{ 'REPORT.Deny' | translate }}</rk-radio>
            </div>
          </div>
        </div>
      </div>

      <div class="rk-modal-item">
        <h5 class="modal-item title"> {{ 'REPORT.AddFilter' | translate }}</h5>

        <rk-select [(value)]="selectedColumnFilter" [options]="columnsOptions"></rk-select>

        <div class="d-flex mt-2">
          <button class="btn btn-icon btn-small w-100 filter-btn-outline mr-2"
            [ngClass]="{'btn-outline-active': modalIsEqual}" (click)="modalIsEqual = true">
            <icon-equal></icon-equal>
          </button>

          <button class="btn btn-icon btn-small w-100 filter-btn-outline"
            [ngClass]="{'btn-outline-active': !modalIsEqual}" (click)="modalIsEqual = false">
            <icon-not-equal></icon-not-equal>
          </button>
        </div>

        <div class="d-flex align-items-center justify-content-between mt-2">
          <input type="text" class="rk-input w-100 mr-2" [(ngModel)]="filterText"
            (keydown.enter)="addManuelFilter()" placeholder="...">

          <button class="btn btn-icon bg-primary fill-white p-0 px-2" style="height: 35px;" (click)="addManuelFilter()"
            [disabled]="filterText?.trim().length === 0">
            <i-feather name="plus" class="mr-0"></i-feather>
          </button>
        </div>

        <div class="mt-3" *ngFor="let filter of getFiltersByColumn(selectedColumnFilter); let filterIndex = index">
          <div class="domain-label mt-3" [ngClass]="{'danger': !filter.equal}"
            *ngFor="let value of filter.values; let valueIndex = index">
            {{ value }}

            <i-feather name="x" class="hover-gray"
              (click)="removeManuelFilter(filter, filterIndex, valueIndex, selectedColumnFilter)"></i-feather>
          </div>
        </div>
      </div>

      <div class="rk-modal-item" style="height: 1px; border-bottom: none;">
        <h5 class="modal-item title"> {{ 'Category' | translate }}</h5>

        <div class="d-flex mt-2">
          <button class="btn btn-icon btn-small w-100 filter-btn-outline mr-2"
            [ngClass]="{'btn-outline-active': modalCategoryIsEqual}" (click)="modalCategoryIsEqual = true">
            <icon-equal></icon-equal>
          </button>

          <button class="btn btn-icon btn-small w-100 filter-btn-outline"
            [ngClass]="{'btn-outline-active': !modalCategoryIsEqual}" (click)="modalCategoryIsEqual = false">
            <icon-not-equal></icon-not-equal>
          </button>
        </div>

        <div class="mt-3">
          <!-- (enterPress)="categoryEnterPress($event)"  -->
          <rk-autocomplete [onSelectClear]="true" [items]="autocompleteItems" (onSelect)="categoryEnterPress($event)">
          </rk-autocomplete>
        </div>

        <div class="mt-3" *ngFor="let filter of getCategoryFilters; let index = index">
          <div class="domain-label mt-3" [ngClass]="{'danger': !filter.equal}"
            *ngFor="let value of filter.values; let valueIndex = index">
            {{ value }}

            <i-feather name="x" class="hover-gray" (click)="removeCategoryFilter(filter, index, valueIndex)">
            </i-feather>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="activeTabNumber === 1">
      <div class="container-fluid">
        <div class="row">
          <div class="col-12 py-2" style="border-bottom: 1px solid #eeeef2;">
            <h6 class="rk-title">{{ 'REPORT.UserReports' | translate }}</h6>

            <div *ngFor="let report of savedReports; let index = index" class="mt-3">
              <div class="rk-radio my-0">
                <input type="radio" id="savedReport-{{ index }}" [(ngModel)]="savedReportValue" name="savedReport"
                  [value]="report.id" (change)="savedReportValueChange($event)">
                <label for="savedReport-{{ index }}">{{ report.name }}</label>
              </div>
            </div>
          </div>

          <div class="col-12 py-2" style="border-bottom: 1px solid #eeeef2;">
            <h6 class="rk-title">{{ 'REPORT.SystemReports' | translate }}</h6>

            <div *ngFor="let report of systemSavedReports; let index = index" class="mt-3">
              <div class="rk-radio my-0">
                <input type="radio" id="savedReportSystem-{{ index }}" [(ngModel)]="savedReportValue" name="savedReport"
                  [value]="report.id" (change)="savedReportValueChange($event)">
                <label for="savedReportSystem-{{ index }}">{{ report.name }}</label>
              </div>
            </div>
          </div>

          <div class="col-12">
            <button class="btn-fill w-100 mt-3" (click)="search('savedreport')">Apply</button>
          </div>
        </div>
      </div>
    </div>
  </rk-modal-body>

  <rk-modal-footer *ngIf="activeTabNumber === 0">
    <button class="btn w-100 btn-small mr-2" (click)="apply(true); search('', true);">{{ 'Apply' | translate }}</button>
    <button class="btn w-100 btn-default btn-small" (click)="modal.toggle()">{{ 'Close' | translate }}</button>
  </rk-modal-footer>
</rk-modal>


<div class="run-bar animated fadeIn" [hidden]="!isShowRunBar">
  <p class="run-bar-text">{{ 'REPORT.ApplyChangedSettings' | translate }}</p>

  <div class="run-bar-buttons">
    <button (click)="search('', true)">{{ 'Run' | translate }}</button>
  </div>
</div>

<div class="container-fluid mt-2">
  <div class="row">
    <div class="col-12">
      <div class="monitor-traffic-search">
        <div class="filter-left">
          <span class="monitor-title">{{ pageTitle }}</span>

          <div class="traffic-types">
            <rk-radio name="trafficType" checked="true" (valueChange)="onTypeValueChange('roksit')">{{ 'REPORT.TotalTraffic' | translate }}
            </rk-radio>
            <rk-radio class="m-l-10" name="trafficType" (valueChange)="onTypeValueChange('roksitblock')">{{ 'REPORT.BlockPage' | translate }}
            </rk-radio>
          </div>
        </div>

        <div class="filter-right">
          <!-- <button class="btn btn-small btn-icon mr-2" (click)="search()">
            <i-feather name="search"></i-feather>
            Search
          </button> -->

          <div style="min-width: 200px;">
            <rk-select [(value)]="searchSettings.dateInterval" (valueChange)="onSelectedDateChange($event)"
              [options]="dateOptions" [placeholder]="'Date selection'"></rk-select>
          </div>
          <div>
            <button class="btn btn-small btn-icon ml-2" (click)="modal.toggle()">
              <i-feather name="filter"></i-feather>
              {{ 'REPORT.Filters' | translate }}
            </button>
          </div>
        </div>
      </div>

      <div class="d-flex align-items-center flex-wrap">
        <div class="d-flex flex-wrap align-items-center" style="width: calc(100% - 335px); padding-right: 25px;">
          <span class="filter-text mb-2">{{ 'REPORT.Filter' | translate }};</span>

          <rk-filter-badge class="ml-2 mb-2" *ngFor="let filter of filters; let index = index" [name]="filter.name"
            [equal]="filter.equal" [values]="filter.values" (deleted)="onDeletedFilterBadge($event, index)"
            (edited)="onEditedFilterBadge(filter)" (onChange)="filterBadgeChange(filter)"></rk-filter-badge>
        </div>

        <div style="width: 335px; min-width: 335px;">
          <button class="btn btn-small report-lb bg-transparent btn-link p-0 mr-3" *ngIf="filters?.length > 0"
            (click)="routeReportPage(pageTitle === 'Monitor Traffic' ? 'custom-reports' : 'monitor')">
            <i-feather name="external-link"></i-feather>
            {{ pageTitle === 'Monitor Traffic' ? 'Custom Reports View' : 'Monitor Traffics View' }}
          </button>
          <button class="btn btn-small report-lb bg-transparent btn-link p-0 mr-3" *ngIf="filters?.length > 0"
            (click)="filtersClear()">{{ 'REPORT.CleanFilters' | translate }}</button>
          <button class="btn btn-small report-lb bg-transparent btn-link p-0" *ngIf="filters?.length > 0"
            (click)="saveFilterClick()">{{ 'REPORT.SaveFilter' | translate }}</button>
        </div>
      </div>
    </div>
  </div>
</div>