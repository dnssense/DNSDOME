<rk-modal #modal>
  <rk-modal-header icon="filter">
    <rk-modal-header-title>
      <h5>Filtrele</h5>
    </rk-modal-header-title>
    <rk-modal-header-close (click)="modal.toggle()"></rk-modal-header-close>
  </rk-modal-header>

  <rk-modal-body>

    <div class="rk-modal-item">
      <h5>Saved Reports</h5>

      <rk-accordion activeNumber="1">
        <rk-accordion-panel>
          <div class="rk-accordion-title">
            User Saved Reports
          </div>

          <div class="rk-accordion-body">
            <div *ngFor="let report of savedReports; let index = index" class="mt-3">
              <div class="rk-radio my-0">
                <input type="radio" id="savedReport-{{ index }}" [(ngModel)]="savedReportValue" name="savedReport"
                  [value]="report.id">
                <label for="savedReport-{{ index }}">{{ report.name }}</label>
              </div>
            </div>
          </div>
        </rk-accordion-panel>

        <rk-accordion-panel>
          <div class="rk-accordion-title">
            System Default Reports
          </div>

          <div class="rk-accordion-body">
            <ul>
              <li *ngFor="let report of systemSavedReports; let index = index" class="mt-3">
                <div class="rk-radio my-0">
                  <input type="radio" id="systemSavedReport-{{ index }}" [(ngModel)]="savedReportValue"
                    name="savedReport" [value]="report.id">
                  <label for="systemSavedReport-{{ index }}">{{ report.name }}</label>
                </div>
              </li>
            </ul>
          </div>
        </rk-accordion-panel>
      </rk-accordion>
    </div>

    <div class="rk-modal-item">
      <h5 class="modal-item title">Action</h5>

      <div class="container-fluid">
        <div class="row">
          <div class="col-12 col-md-6">
            <rk-radio name="actionType" class="rk-radio-m-0" [checked]="actionType === 'allow'" value="allow"
              (valueChange)="actionChanged($event)">Allow</rk-radio>
          </div>
          <div class="col-12 col-md-6">
            <rk-radio name="actionType" class="rk-radio-m-0" [checked]="actionType === 'deny'" value="deny"
              (valueChange)="actionChanged($event)">Deny</rk-radio>
          </div>
        </div>
      </div>
    </div>

    <div class="rk-modal-item">
      <h5 class="modal-item title">Add Filter</h5>

      <rk-select [(value)]="selectedColumnFilter" [options]="columnsOptions"></rk-select>

      <div class="d-flex mt-2">
        <button class="btn btn-icon btn-small w-100 filter-btn-outline mr-2"
          [ngClass]="{'btn-outline-active': modalIsEqual}" (click)="modalIsEqual = true">
          <icon-equal></icon-equal>
        </button>

        <button class="btn btn-icon btn-small w-100 filter-btn-outline"
          [ngClass]="{'btn-outline-active': !modalIsEqual}" (click)="modalIsEqual = false">
          <icon-not-equal></icon-not-equal>
        </button>
      </div>

      <input type="text" class="rk-input w-100 mt-3" [(ngModel)]="filterText" placeholder="abc.com"
        (keydown.enter)="addManuelFilter()">

      <div class="domain-label mt-3" *ngFor="let filter of manuelFilters; let index = index"
        [ngClass]="{'danger': !filter.equal}">
        {{ filter.values[0] }}

        <i-feather name="x" class="hover-gray" (click)="removeManuelFilter(index)"></i-feather>
      </div>
    </div>

    <div class="rk-modal-item" style="height: 1px; border-bottom: none;">
      <h5 class="modal-item title">Category</h5>

      <div class="rk-category-container mt-3" *ngFor="let category of groupedCategories; let index = index"
        [ngClass]="{'mb-3': groupedCategories.length -1 === index}">
        <div class="category-header">
          <rk-checkbox class="checkbox" size="sm" className="m-0" (valueChange)="checkboxValueChange($event, category)">
          </rk-checkbox>

          <span class="category-color" [style.background]="category.color"></span>

          <h6 class="category-title">{{ category.name }}</h6>
        </div>

        <div class="category-body">
          <div class="category-item" *ngFor="let item of category.items">
            <rk-checkbox size="sm" alignment="right" [(value)]="item.selected"
              (valueChange)="childCheckboxValueChanged($event, item)">{{ item.name }}</rk-checkbox>
          </div>
        </div>
      </div>
    </div>
  </rk-modal-body>

  <rk-modal-footer>
    <button class="btn w-100 btn-small mr-2" (click)="apply(true)">Apply</button>
    <button class="btn w-100 btn-default btn-small" (click)="clear()">Clean</button>
  </rk-modal-footer>
</rk-modal>

<div class="monitor-traffic-search">
  <div class="filter-left">
    <span class="monitor-title">{{ pageTitle }}</span>

    <div class="traffic-types">
      <rk-radio name="trafficType" checked="true" (valueChange)="onTypeValueChange('roksit')">Total traffic</rk-radio>
      <rk-radio class="m-l-10" name="trafficType" (valueChange)="onTypeValueChange('roksitblock')">Block Page</rk-radio>
    </div>
  </div>

  <div class="filter-right">
    <button class="btn btn-small btn-icon mr-2" (click)="search()">
      <i-feather name="search"></i-feather>
      Search
    </button>

    <div style="min-width: 200px;">
      <rk-select [(value)]="searchSettings.dateInterval" (valueChange)="onSelectedDateChange($event)"
        [options]="dateOptions" [placeholder]="'Date selection'"></rk-select>
    </div>
    <div>
      <button class="btn btn-small btn-icon ml-2" (click)="modal.toggle()">
        <i-feather name="filter"></i-feather>
        Filtreler
      </button>
    </div>
  </div>
</div>

<div class="d-flex flex-wrap align-items-center">
  <span class="filter-text mb-2">Filter;</span>
  <div class="ml-2 mb-2" *ngFor="let filter of this.searchSettings.must; let index = index">
    <rk-filter-badge [name]="filter.field" [index]="index" [equal]="true" [values]="filter.value.split(',')"
      (onChange)="onChangeFilterBadge($event, 'must')" (edited)="onEditedFilterBadge($event, 'must')"
      (deleted)="onDeletedFilterBadge($event, 'must')"></rk-filter-badge>
  </div>

  <div class="ml-2 mb-2" *ngFor="let filter of this.searchSettings.mustnot; let index = index">
    <rk-filter-badge [name]="filter.field" [index]="index" [equal]="false" [values]="filter.value.split(',')"
      (onChange)="onChangeFilterBadge($event, 'mustnot')" (edited)="onEditedFilterBadge($event, 'mustnot')"
      (deleted)="onDeletedFilterBadge($event, 'mustnot')"></rk-filter-badge>
  </div>
</div>