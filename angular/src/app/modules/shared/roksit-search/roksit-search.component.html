<rk-modal #saveModal>
  <rk-modal-header>
    <rk-modal-header-title>
      <h5>Save Report</h5>
    </rk-modal-header-title>

    <rk-modal-header-close (click)="saveModal.toggle()"></rk-modal-header-close>
  </rk-modal-header>

  <rk-modal-body>

    <div class="container-fluid">
      <div class="row">
        <div class="col-12">
          <div class="rk-title">Report name</div>

          <input type="text" class="rk-input w-100 mt-1" placeholder="Filter Name" [(ngModel)]="newSavedReport.name">
        </div>

        <div class="col-12 mt-3">
          <div class="rk-title">Schedule report send to email</div>
          <div class="mt-2">
            <rk-radio class="rk-radio-m-0" (valueChange)="changeSavedReportType($event)" name="savedReportFilter"
              value="all">
              All
            </rk-radio>
          </div>
          <div class="mt-2">
            <rk-radio class="rk-radio-m-0" (valueChange)="changeSavedReportType($event)" name="savedReportFilter"
              value="d">
              Schedule Daily report email
            </rk-radio>
          </div>
          <div class="mt-2">
            <rk-radio class="rk-radio-m-0" (valueChange)="changeSavedReportType($event)" name="savedReportFilter"
              value="w">
              Schedule Weekly report email
            </rk-radio>
          </div>
          <div class="mt-2">
            <rk-radio class="rk-radio-m-0" (valueChange)="changeSavedReportType($event)" name="savedReportFilter"
              value="m">
              Schedule Montly report email
            </rk-radio>
          </div>
        </div>

        <!-- <div class="col-12 mt-3" *ngIf="newSavedReport?.scheduledReport !== 'all'">
          <div class="rk-title">Users</div>

          <div class="rk-modal-item p-0" style="height: 1px; border-bottom: none;">
            <div class="rk-category-container mt-3">
              <div class="category-header category-item">
                <rk-checkbox class="checkbox" alignment="right" size="sm" className="m-0"
                  (valueChange)="toggleAllUsers($event)">
                  All Users
                </rk-checkbox>
              </div>

              <div class="category-body">
                <div class="category-item" *ngFor="let user of users">
                  <rk-checkbox size="sm" alignment="right" [(value)]="user.selected">{{ user.username }}</rk-checkbox>
                </div>
              </div>
            </div>
          </div>
        </div> -->
      </div>
    </div>

  </rk-modal-body>

  <rk-modal-footer>
    <button class="btn btn-small w-100 mr-2" (click)="saveReport()">Apply</button>
    <button class="btn btn-small btn-default w-100" (click)="saveModal.toggle()">Cancel</button>
  </rk-modal-footer>
</rk-modal>

<rk-modal #modal>
  <rk-modal-header icon="filter">
    <rk-modal-header-title>
      <h5>Filtrele</h5>
    </rk-modal-header-title>
    <rk-modal-header-close (click)="modal.toggle()"></rk-modal-header-close>
  </rk-modal-header>

  <rk-modal-body>

    <div class="rk-modal-item">
      <h5>Saved Reports</h5>

      <rk-accordion activeNumber="1">
        <rk-accordion-panel>
          <div class="rk-accordion-title">
            User Saved Reports
          </div>

          <div class="rk-accordion-body">
            <div *ngFor="let report of savedReports; let index = index" class="mt-3">
              <div class="rk-radio my-0">
                <input type="radio" id="savedReport-{{ index }}" [(ngModel)]="savedReportValue" name="savedReport"
                  [value]="report.id" (change)="savedReportValueChange($event)">
                <label for="savedReport-{{ index }}">{{ report.name }}</label>
              </div>
            </div>
          </div>
        </rk-accordion-panel>

        <rk-accordion-panel>
          <div class="rk-accordion-title">
            System Default Reports
          </div>

          <div class="rk-accordion-body">
            <ul>
              <li *ngFor="let report of systemSavedReports; let index = index" class="mt-3">
                <div class="rk-radio my-0">
                  <input type="radio" id="systemSavedReport-{{ index }}" [(ngModel)]="savedReportValue"
                    name="savedReport" [value]="report.id" (change)="savedReportValueChange($event)">
                  <label for="systemSavedReport-{{ index }}">{{ report.name }}</label>
                </div>
              </li>
            </ul>
          </div>
        </rk-accordion-panel>
      </rk-accordion>
    </div>

    <div class="rk-modal-item">
      <h5 class="modal-item title">Action</h5>

      <div class="container-fluid">
        <div class="row">
          <div class="col-12 col-md-6">
            <rk-radio name="actionType" class="rk-radio-m-0" [checked]="actionType === 'allow'" value="allow"
              (valueChange)="actionChanged($event)">Allow</rk-radio>
          </div>
          <div class="col-12 col-md-6">
            <rk-radio name="actionType" class="rk-radio-m-0" [checked]="actionType === 'deny'" value="deny"
              (valueChange)="actionChanged($event)">Deny</rk-radio>
          </div>
        </div>
      </div>
    </div>

    <div class="rk-modal-item">
      <h5 class="modal-item title">Add Filter</h5>

      <rk-select [(value)]="selectedColumnFilter" [options]="columnsOptions"></rk-select>

      <div class="d-flex mt-2">
        <button class="btn btn-icon btn-small w-100 filter-btn-outline mr-2"
          [ngClass]="{'btn-outline-active': modalIsEqual}" (click)="modalIsEqual = true">
          <icon-equal></icon-equal>
        </button>

        <button class="btn btn-icon btn-small w-100 filter-btn-outline"
          [ngClass]="{'btn-outline-active': !modalIsEqual}" (click)="modalIsEqual = false">
          <icon-not-equal></icon-not-equal>
        </button>
      </div>

      <div class="d-flex align-items-center justify-content-between mt-2">
        <input type="text" class="rk-input w-100 mr-2" [(ngModel)]="filterText" placeholder="abc.com"
          (keydown.enter)="addManuelFilter()">

        <button class="btn btn-icon bg-primary fill-white p-0 px-2" style="height: 35px;" (click)="addManuelFilter()"
          [disabled]="filterText?.trim().length === 0">
          <i-feather name="plus" class="mr-0"></i-feather>
        </button>
      </div>

      <div class="mt-3" *ngFor="let filter of getFiltersByColumn(selectedColumnFilter); let filterIndex = index">
        <div class="domain-label mt-3" [ngClass]="{'danger': !filter.equal}"
          *ngFor="let value of filter.values; let valueIndex = index">
          {{ value }}

          <i-feather name="x" class="hover-gray" (click)="removeManuelFilter(filter, filterIndex, valueIndex, selectedColumnFilter)"></i-feather>
        </div>
      </div>
    </div>

    <div class="rk-modal-item" style="height: 1px; border-bottom: none;">
      <h5 class="modal-item title">Category</h5>

      <div class="d-flex mt-2">
        <button class="btn btn-icon btn-small w-100 filter-btn-outline mr-2"
          [ngClass]="{'btn-outline-active': modalCategoryIsEqual}" (click)="modalCategoryIsEqual = true">
          <icon-equal></icon-equal>
        </button>

        <button class="btn btn-icon btn-small w-100 filter-btn-outline"
          [ngClass]="{'btn-outline-active': !modalCategoryIsEqual}" (click)="modalCategoryIsEqual = false">
          <icon-not-equal></icon-not-equal>
        </button>
      </div>

      <div class="mt-3">
        <!-- (enterPress)="categoryEnterPress($event)"  -->
        <rk-autocomplete [onSelectClear]="true" [items]="autocompleteItems" (onSelect)="categoryEnterPress($event)">
        </rk-autocomplete>
      </div>

      <div class="mt-3" *ngFor="let filter of getCategoryFilters; let index = index">
        <div class="domain-label mt-3" [ngClass]="{'danger': !filter.equal}"
          *ngFor="let value of filter.values; let valueIndex = index">
          {{ value }}

          <i-feather name="x" class="hover-gray" (click)="removeCategoryFilter(filter, index, valueIndex)"></i-feather>
        </div>
      </div>
    </div>
  </rk-modal-body>

  <rk-modal-footer>
    <button class="btn w-100 btn-small mr-2" (click)="apply(true); search('', true);">Apply</button>
    <button class="btn w-100 btn-default btn-small" (click)="modal.toggle()">Cancel</button>
  </rk-modal-footer>
</rk-modal>

<div class="monitor-traffic-search">
  <div class="filter-left">
    <span class="monitor-title">{{ pageTitle }}</span>

    <div class="traffic-types">
      <rk-radio name="trafficType" checked="true" (valueChange)="onTypeValueChange('roksit')">Total traffic</rk-radio>
      <rk-radio class="m-l-10" name="trafficType" (valueChange)="onTypeValueChange('roksitblock')">Block Page</rk-radio>
    </div>
  </div>

  <div class="filter-right">
    <!-- <button class="btn btn-small btn-icon mr-2" (click)="search()">
      <i-feather name="search"></i-feather>
      Search
    </button> -->

    <div style="min-width: 200px;">
      <rk-select [(value)]="searchSettings.dateInterval" (valueChange)="onSelectedDateChange($event)"
        [options]="dateOptions" [placeholder]="'Date selection'"></rk-select>
    </div>
    <div>
      <button class="btn btn-small btn-icon ml-2" (click)="modal.toggle()">
        <i-feather name="filter"></i-feather>
        Filtreler
      </button>
    </div>
  </div>
</div>

<div class="d-flex align-items-center">
  <div class="d-flex flex-wrap align-items-center" style="flex: 1">
    <span class="filter-text mb-2">Filter;</span>

    <div class="ml-2 mb-2" *ngFor="let filter of filters; let index = index">
      <rk-filter-badge [name]="filter.name" [equal]="filter.equal" [values]="filter.values"
        (deleted)="onDeletedFilterBadge($event, index)" (edited)="onEditedFilterBadge(filter)"
        (onChange)="filterBadgeChange(filter)"></rk-filter-badge>
    </div>

  </div>

  <button class="btn btn-small report-lb bg-transparent btn-link p-0 mr-3" *ngIf="filters?.length > 0"
    (click)="routeReportPage(pageTitle === 'Monitor Traffic' ? 'custom-reports' : 'monitor')">
    <i-feather name="external-link"></i-feather>
    {{ pageTitle === 'Monitor Traffic' ? 'Custom Reports View' : 'Monitor Traffics View' }}
  </button>
  <button class="btn btn-small report-lb bg-transparent btn-link p-0 mr-3" *ngIf="filters?.length > 0"
    (click)="filtersClear()">Clean Filters</button>
  <button class="btn btn-small report-lb bg-transparent btn-link p-0" *ngIf="filters?.length > 0"
    (click)="saveFilterClick()">Save
    Filter</button>
</div>

<div class="run-bar justify-content-between" [hidden]="!isShowRunBar">
  <p class="run-bar-text">Hazırladığınız filtreyle sorgu yapmak için butona tıklayın.</p>

  <div class="run-bar-buttons">
    <button (click)="search('', true)">Çalıştır</button>
  </div>

  <button class="btn-close" (click)="setShowRunBar(false)">
    <i-feather name="x"></i-feather>
  </button>
</div>