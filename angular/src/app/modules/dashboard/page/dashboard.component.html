<div class="main-content">
  <div class="container-fluid mt-3 mb-3">
    <div class="row mx-0">
      <div class="col-12 p-0">
        <div class="container-fluid dashboard">
          <div class="row infos">
            <div class="col-12 col-lg-4 d-flex justify-content-lg-around justify-content-md-between" *ngFor="let data of agentCounts">
              <h5 class="title">{{ data.name | translate }}</h5>

              <div class="values">
                <div class="active">
                  <span class="name">{{'Active' | translate}}</span>
                  <span class="value">{{ data.activeCount }}</span>
                </div>

                <div class="passive">
                  <span class="name">{{'Passive'|translate}}</span>
                  <span class="value">{{ data.passiveCount }}</span>
                </div>
              </div>
            </div>
          </div>

          <div class="row mt-2">
            <div class="rk-base-card p-0">
              <div class="card-item content" style="padding: 20px 0;">
                <div class="container-fluid">
                  <div class="row">
                    <div class="col-12">
                      <div class="d-flex justify-content-between align-items-center">
                        <div class="rk-title-2">{{'DASHBOARD.TrafficBasedAnomaly'|translate}}</div>

                        <div class="d-flex align-items-start justify-content-end">
                          <button class="btn btn-small mr-2 d-none d-xl-flex" *ngFor="let dateButton of dateButtons"
                            (click)="setDateByDateButton(dateButton)"
                            [ngClass]="{'active': dateButton?.active}">{{ dateButton.displayText }}</button>

                          <icon-equal style="margin: 11px 10px 0" class="d-none d-xl-block"></icon-equal>

                          <div class="d-flex flex-column text-center">
                            <rk-date #date [startDate]="startDate" [endDate]="endDate" (complete)="dateChanged($event, true)"
                              [alignment]="'right'"></rk-date>

                            <span class="date-text mt-1">{{ dateText }}</span>

                            <!-- <span class="date-text mt-1" *ngIf="diffrence">{{ diffrence }} gün</span> -->
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="row">
                    <div class="col-12 col-lg-6 col-xl mt-3">
                      <rk-infobox [active]="infoBoxes.total"  (change)="infoboxChanged($event, 'total', 'Total')"
                        [title]="translate('Total')" [color]="'#4353ff'" className="blue" [type]="1"
                        [valueOne]="trafficAnomaly?.total?.hit" [valueTwo]="trafficAnomaly?.total?.block"
                        [description]="translate('DASHBOARD.TotalDnsRequestCount')">
                      </rk-infobox>
                    </div>

                    <div class="col-12 col-lg-6 col-xl mt-3">
                      <rk-infobox [active]="infoBoxes.safe" [type]="2" (change)="infoboxChanged($event, 'safe', 'Safe')"
                        [title]="translate('Safe')" [color]="'#3dd49a'" className="green"
                        [valueOne]="trafficAnomaly?.safe?.hit" [valueTwo]="trafficAnomaly?.safe?.hit_ratio"
                        description="{{'SafeDescription'|translate}}">
                      </rk-infobox>
                    </div>

                    <div class="col-12 col-lg-6 col-xl mt-3">
                      <rk-infobox [active]="infoBoxes.malicious"
                         (change)="infoboxChanged($event, 'malicious', 'Malicious')" [type]="2"
                        [title]="translate('Malicious')" className="red" [color]="'#f95656'"
                        [valueOne]="trafficAnomaly?.malicious?.hit" [valueTwo]="trafficAnomaly?.malicious?.hit_ratio"
                        description="{{'MaliciousDescription'|translate}}">
                      </rk-infobox>
                    </div>

                    <div class="col-12 col-lg-6 col-xl mt-3">
                      <rk-infobox [active]="infoBoxes.variable"
                        (change)="infoboxChanged($event, 'variable', 'Variable')" [type]="2"
                        [title]="translate('Variable')" className="gray" [color]="'#d8d8d8'"
                        [valueOne]="trafficAnomaly?.variable?.hit" [valueTwo]="trafficAnomaly?.variable?.hit_ratio"
                        description="{{'VariableDescription'|translate}}">
                      </rk-infobox>
                    </div>

                    <div class="col-12 col-lg-6 col-xl mt-3">
                      <rk-infobox [active]="infoBoxes.harmful"
                         (change)="infoboxChanged($event, 'harmful', 'HarmfullContent')" [type]="2"
                        [title]="translate('HarmfullContent')" className="yellow" [color]="'#f9df56'"
                        [valueOne]="trafficAnomaly?.harmful?.hit" [valueTwo]="trafficAnomaly?.harmful?.hit_ratio"
                        description="{{'HarmfulDescription'|translate}}">
                      </rk-infobox>
                    </div>
                  </div>

                  <div class="row mt-3">
                    <div class="col-12">
                      <div class="section-card">

                        <div class="container-fluid">
                          <div class="row">
                            <div class="categories-column mt-3 d-flex flex-column justify-content-between"
                              style="border-right: 1px solid var(--infobox-border);">
                              <h6 class="rk-title-1">
                                {{ selectedCategoryName | translate }}
                                <span *ngIf="selectedBox !== 'total'">{{ 'Categories' | translate }}</span>
                              </h6>

                              <div class="rk-selectable-container mb-2">
                                <table class="rk-selectable-table w-100">
                                  <tr *ngFor="let cat of categoryListFiltered; let index = index"
                                    class="rk-c-{{ selectedBox }}"
                                    [ngClass]="{ 'active' : selectedCategory?.name == cat.name }"
                                    (click)="selectCategory(cat)" [title]="cat.name">
                                    <td class="idx pr-1">{{ index + 1 }}</td>
                                    <td class="text">
                                      <div class="overflowed-text">
                                        {{ cat.name }}
                                      </div>
                                    </td>
                                    <td class="value">{{ getRoundedNumber(cat.hit) }}</td>
                                    <td class="percent">%{{ cat.hit_ratio }}</td>
                                  </tr>
                                </table>
                              </div>
                            </div>

                            <div class="anomaly-chart mt-3">
                              <div class="d-flex flex-wrap justify-content-between align-items-center" *ngIf="trafficChart">
                                <!-- <button class="btn btn-link btn-accent py-0" style="background: transparent;"
                                  (click)="showSummary()">{{'DASHBOARD.ShowSummary'|translate}}</button> -->

                                <div style="flex: 1">
                                  <span class="chart-marker-info">
                                    <span style="background-color:#4353ff;"></span>%30
                                  </span>
                                  <span class="chart-marker-info">
                                    <span style="background-color:#3dd49a;"></span>%50
                                  </span>
                                  <span class="chart-marker-info">
                                    <span style="background-color:#f9df56;"></span>%70
                                  </span>
                                  <span class="chart-marker-info">
                                    <span style="background-color:#f99256;"></span>%80
                                  </span>
                                  <span class="chart-marker-info">
                                    <span style="background-color:#f95656;"></span>%100
                                  </span>
                                </div>

                                <div class="d-flex align-items-center justify-content-end">
                                  <button class="btn btn-link btn-icon py-0 bg-transparent"
                                    *ngIf="calculateDateDiff() <= 7" (click)="getDataByTime('prev', 7)">
                                    <i-feather name="arrow-left"></i-feather>
                                    {{ 'PreviousWeek' | translate }}
                                  </button>

                                  <button class="btn btn-link btn-icon py-0 bg-transparent"
                                    *ngIf="calculateDateDiff() <= 7" [disabled]="getDisabledNextButton('week')" (click)="getDataByTime('next', 7)">
                                    {{ 'NextWeek' | translate }}
                                    <i-feather name="arrow-right"></i-feather>
                                  </button>
                                  
                                  <button class="btn btn-link btn-icon py-0 bg-transparent"
                                    *ngIf="calculateDateDiff() >= 30 && calculateDateDiff() < 90" (click)="getDataByTime('prev', 30)">
                                    <i-feather name="arrow-left"></i-feather>
                                    {{ 'PreviousMonth' | translate }}
                                  </button>

                                  <button class="btn btn-link btn-icon py-0 bg-transparent"
                                    *ngIf="calculateDateDiff() >= 30 && calculateDateDiff() < 90" (click)="getDataByTime('next', 30)">
                                    {{ 'NextMonth' | translate }}
                                    <i-feather name="arrow-right"></i-feather>
                                  </button>
                                  
                                  <button class="btn btn-link btn-icon py-0 bg-transparent"
                                    *ngIf="calculateDateDiff() >= 90" [disabled]="calculateDateDiff() >= 365" (click)="getDataByTime('prev', 90)">
                                    <i-feather name="arrow-left"></i-feather>
                                    {{ 'Previous3Month' | translate }}
                                  </button>

                                  <button class="btn btn-link btn-icon py-0 bg-transparent"
                                    *ngIf="calculateDateDiff() >= 90" [disabled]="calculateDateDiff() >= 365" (click)="getDataByTime('next', 90)">
                                    {{ 'Next3Month' | translate }}
                                    <i-feather name="arrow-right"></i-feather>
                                  </button>

                                  <button class="btn btn-small btn-outline"
                                    (click)="showDetail()">{{'DASHBOARD.ShowDetail'|translate}}</button>
                                </div>
                              </div>

                              <div class="chart" id="chart"></div>
                            </div>
                          </div>
                        </div>

                      </div>
                    </div>
                  </div>

                  <div class="row mt-3">
                    <div class="col-12">
                      <div class="section-card">
                        <div class="container-fluid">
                          <div class="row">
                            <div class="col-12 mt-3" style="border-bottom: 1px solid var(--infobox-border);">
                              <h6 class="rk-title-1">{{ selectedCategoryName | translate }} {{ 'TopDomainList' | translate }}
                              </h6>
                            </div>

                            <div class="top-domain-list-column d-flex flex-column"
                              style="border-right: 1px solid var(--infobox-border);">
                              <div class="rk-selectable-container" style="max-height: 340px;">
                                <table class="rk-selectable-table">
                                  <thead>
                                    <tr>
                                      <th style="width: 30px">#</th>
                                      <th style="width: 100px">{{'Domain'|translate}}</th>
                                      <th style="width: 120px">{{'Categories'|translate}}</th>
                                      <th>{{'Count'|translate}}</th>
                                      <th style="width: 60px;">{{'Percent'|translate}}</th>
                                    </tr>
                                  </thead>

                                  <tbody class="rk-selectable-table-body">
                                    <tr *ngFor="let domain of topDomains; let index = index"
                                      [ngClass]="{'active': items[0]?.value === domain.name}"
                                      (click)="addDomain(domain)" class="rk-c-{{ selectedBox }}">
                                      <td class="idx" style="width: 40px">{{ index + 1 }}</td>
                                      <td class="text">
                                        <div class="overflowed-text">{{ domain.name }}</div>
                                      </td>
                                      <td class="text">
                                        <div class="overflowed-text">{{domain.category}}</div>
                                      </td>
                                      <td class="value">{{ getRoundedNumber(domain.hit) }}</td>
                                      <!-- <td>
                                        <rk-progressbar-n [value]="100 * domain.hit / topDomainsCountTotal | number">
                                        </rk-progressbar-n>
                                      </td> -->
                                      <td class="percent">
                                        %{{100 * domain.hit / topDomainsCountTotal | number}}</td>
                                    </tr>
                                  </tbody>
                                </table>
                              </div>
                            </div>

                            <div class="top-domain-chart pt-2 d-flex flex-column justify-content-between">
                              <div class="search d-flex justify-content-between">
                                <div class="tag-input-container w-100">
                                  <tag-input [(ngModel)]="items" (onAdd)="onItemAdded($event)" [maxItems]="1">
                                  </tag-input>
                                </div>

                                <button class="btn btn-accent ml-3" (click)="search()">{{'Search'|translate}}</button>
                              </div>

                              <div class="unique-chart" id="topDomainChart"></div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>