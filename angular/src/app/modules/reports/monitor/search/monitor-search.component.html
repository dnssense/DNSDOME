<div class="dns-base-card">
  <div class="dns-base-card-header">
    <div class="row">
      <div class="col-md-7 d-flex align-items-center">
        <div class="search-form full-width flex-1">
          <img src="assets/images/icons/search.svg" class="icon">
          <input type="text" class="dns-form-control reverse-form" placeholder="Contain *keyword*"
            [(ngModel)]="searchSetting.query" [ngModelOptions]="{ standalone: true }" />
        </div>
        <div class="dns-toggle dns-reverse-toggle" style="padding: 4px">
          <button class="btns" [ngClass]="{'active': searchSetting.type=='roksit'}"
            (click)="changeSearchSettingType('roksit')">Total Traffic</button>
          <button class="btns" [ngClass]="{'active': searchSetting.type=='roksitblock'}"
            (click)="changeSearchSettingType('roksitblock')">SecurityGAP</button>
        </div>
      </div>
      <div class="col-md-5 d-flex mt-2">
        <!-- <button mat-raised-button class="btn btn-light mt-0 mr-2 ml-auto" style="height: 40px;">
          <span class="btn-label">
            <i class="fa fa-save size-20 position-relative top-3"></i>
          </span>
          Save
        </button> -->
        <div class="dns-dropdown d-inline-block dns-table-select pull-right ml-auto mr-2" style="min-width:180px">
          <button class="btns reverse-form dropdown-toggle text-left" type="button" data-toggle="dropdown"
            aria-haspopup="false" aria-expanded="false">
            <span class="btn-label">
              <i class="fa fa-save size-20 position-relative top-3"></i>
            </span>
            <ng-container *ngIf="selectedSavedReportName; else elseTemplateselectedSavedReportName">
              {{selectedSavedReportName}}
            </ng-container>
            <ng-template #elseTemplateselectedSavedReportName>
              Saved Reports <i class="icon-down-open-big btn-arrow" style="font-size: 20px"></i>
            </ng-template>
          </button>
          <div class="dropdown-menu dropdown-menu-right">
            <div class="table-responsive" style="max-height: 400px;">
              <div class="tab-pane fade show active">
                  <span class="dropdown-item text-center" style="background-color: #181818">User Reports</span>
                  <div *ngFor="let r of savedReports">
                    <button class="dropdown-item" *ngIf="r.system == null || r.system == false"
                      (click)="selectSavedReport(r.id)">
                      <div class="row">
                        <div class="col-md-10">{{r.name}}</div>
                        <div class="col-md-2 text-right"><i class="close-btn icon-cancel" (click)="deleteSavedReport(r)"></i></div>
                      </div>
                    </button>
                  </div>
                  <span class="dropdown-item text-center"  style="background-color: #181818">System Reports</span>
                  <div *ngFor="let r of savedReports">
                    <button class="dropdown-item" *ngIf="r.system" (click)="selectSavedReport(r.id)">
                      <div class="row">
                        <div class="col-md-10">{{r.name}}</div>
                        <div class="col-md-2 text-right"><i class="dns-close-btn icon-cancel" (click)="deleteSavedReport(r)"></i></div>
                      </div>
                    </button>
                  </div>
              </div>
            </div>
          </div>
        </div>
        <div class="dns-dropdown d-inline-block dns-table-select pull-right ml-auto" id="searchBoxDropdownDate">
          <button class="btns reverse-form dropdown-toggle text-left" type="button" id="dropdownMenuButton"
            data-toggle="dropdown" aria-haspopup="false" aria-expanded="false">
            <img src="assets/images/icons/calendar.svg">
            <span [ngSwitch]="searchSetting.dateInterval">
              <ng-container *ngSwitchCase="5">
                Last 5 minutes
              </ng-container>
              <ng-container *ngSwitchCase="15">
                Last 15 minutes
              </ng-container>
              <ng-container *ngSwitchCase="30">
                Last 30 minutes
              </ng-container>
              <ng-container *ngSwitchCase="60">
                Last 1 hour
              </ng-container>
              <ng-container *ngSwitchCase="180">
                Last 3 hours
              </ng-container>
              <ng-container *ngSwitchCase="720">
                Last 12 hours
              </ng-container>
              <ng-container *ngSwitchCase="1440">
                Last 1 day
              </ng-container>
              <ng-container *ngSwitchCase="2880">
                Last 2 day
              </ng-container>
              <ng-container *ngSwitchCase="10080">
                Last 1 week
              </ng-container>
              <ng-container *ngSwitchDefault>
                {{searchStartDate}} - {{searchEndDate}}
              </ng-container>
            </span>
            <i class="icon-down-open-big btn-arrow" style="font-size: 20px"></i>
          </button>
          <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton">
            <ul class="nav nav-tabs mb-2" id="myTab" role="tablist">
              <li class="nav-item">
                <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home"
                  (click)="closeCalendarTab('home')" aria-selected="true">Time Templates</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab"
                  (click)="closeCalendarTab('profile')" aria-controls="profile" aria-selected="false">Calendar</a>
              </li>
            </ul>
            <div class="tab-content" id="myTabContent">
              <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
                <button class="dropdown-item" (click)="changeSearchSettingDate('5')">Last 5 minutes</button>
                <button class="dropdown-item" (click)="changeSearchSettingDate('15')">Last 15 minutes</button>
                <button class="dropdown-item" (click)="changeSearchSettingDate('30')">Last 30 minutes</button>
                <button class="dropdown-item" (click)="changeSearchSettingDate('60')">Last 1 hour</button>
                <button class="dropdown-item" (click)="changeSearchSettingDate('180')">Last 3 hours</button>
                <button class="dropdown-item" (click)="changeSearchSettingDate('720')">Last 12 hours</button>
                <button class="dropdown-item" (click)="changeSearchSettingDate('1440')">Last 1 day</button>
                <button class="dropdown-item" (click)="changeSearchSettingDate('2880')">Last 2 day</button>
                <button class="dropdown-item" (click)="changeSearchSettingDate('10080')">Last 1 week</button>
              </div>
              <div class="tab-pane fade overflow-hidden" id="profile" role="tabpanel" aria-labelledby="profile-tab">
                <input type="hidden" class="dt datepicker2" id="searchDateInput" (change)="searchDateChanged()">

                <div class="dropdown-divider"></div>
                <div class="container-fluid">
                  <div class="row mt-2 mb-3">
                    <div class="col-5 mr-auto ml-auto">
                      <span class="dns-dropdown-label" style="padding-left: 0px">Start Date Time</span>
                      <!-- <input type="text" readonly [(ngModel)]="searchStartDate" class="dns-form-control reverse-form "> -->
                      <input type="text" style="display: none;" mwlFlatpickr [(ngModel)]="searchStartDateTime"
                        [altInput]="false" [enableTime]="true" [dateFormat]="'H:i'" [noCalendar]="true" [inline]="true"
                        [time24hr]="true">
                    </div>
                    <div class="col-5 mr-auto ml-auto">
                      <span class="dns-dropdown-label" style="padding-left: 0px">End Date Time</span>
                      <input type="text" style="display: none;" mwlFlatpickr [(ngModel)]="searchEndDateTime"
                        [altInput]="false" [enableTime]="true" [dateFormat]="'H:i'" [noCalendar]="true" [inline]="true"
                        [time24hr]="true">
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-md-4 ml-auto mr-auto">
                      <button class="btn btn-teritary btn-sm" (click)="closeSearchBoxDropdownDate()">Ok</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="dns-base-card-content mt-3">
    <div class="row ">
      <div class="col-10">
        <button class="btns btn-success size-13 mr-1 mt-1 mb-1 filterButton" *ngFor="let item of searchSetting.must">
          {{item.field}}, Is, {{item.value}}
          <img src="assets/images/icons/editF.svg" class="editButton ml-2" width="15" height="15" alt=""
            (click)="editTag(item,'is')">
          <img src="assets/images/icons/white.svg" class="editButton ml-2" width="15" height="15" alt=""
            (click)="removeTag(item,'is')">
        </button>
        <button class="btns btn-danger size-13 mr-1 mt-1 mb-1 filterButton"
          *ngFor="let item of searchSettingForHtml.mustnot">
          {{item.field}}, Is NOT, {{item.value}}
          <img src="assets/images/icons/editF.svg" class="editButton ml-2" width="15" height="15" alt=""
            (click)="editTag(item,'isnot')">
          <img src="assets/images/icons/white.svg" class="editButton ml-2" width="15" height="15" alt=""
            (click)="removeTag(item,'isnot')">
        </button>
        <button class="btns btn-warning size-13 mr-1 mt-1 mb-1 filterButton"
          *ngFor="let item of searchSettingForHtml.should">
          {{item.field}}, Is One Of, {{item.value}}
          <img src="assets/images/icons/editF.svg" class="editButton ml-2" width="15" height="15" alt=""
            (click)="editTag(item,'isoneof')">
          <img src="assets/images/icons/white.svg" class="editButton ml-2" width="15" height="15" alt=""
            (click)="removeTag(item, 'isoneof')">
        </button>
        <button class="btns btn-clear size-14" (click)="removeAllTags()">
          <img src="assets/images/icons/close.svg">
          Clear All Filter
        </button>
        <div class="dns-dropdown d-inline-block" id="dropdownFilter">
          <button class="btns dropdown-toggle" type="button" data-toggle="dropdown"
            (click)="refreshFilterPanel()" aria-haspopup="true" aria-expanded="false">
            <i class="icon-plus pr-2" style="font-size: 20px"></i>
            Add Filter
          </button>
          <div class="dropdown-menu" style="width: 600px" id="tagsDd">
            <div class="container-fluid">
              <div class="row">
                <div class="col-12 col-lg-3 pr-0 mt-2">
                  <div class="1dnssense-select light-select full-width">
                    <select class="filterTags" (change)="changeCurrentColumn(currentColumn)" [(ngModel)]="currentColumn"
                      [ngModelOptions]="{ standalone: true }">
                      <option value="{{item.name}}" *ngFor="let item of columns">
                        {{item.beautyName}}</option>
                    </select>
                  </div>
                </div>
                <div class="col-12 col-lg-3 pr-0 mt-2">
                  <div class="1dnssense-select light-select full-width">
                    <select class="filterTags" [(ngModel)]="currentOperator" [ngModelOptions]="{ standalone: true }"
                      (change)="changeCurrentColumn(currentColumn)">
                      <option value="is">Is</option>
                      <option value="isnot">Is Not</option>
                      <option value="isoneof">Is One Of</option>
                      <option value="isnotoneof">Is Not One Of</option>
                    </select>
                  </div>
                </div>
                <div class="col-12 col-lg-6 mt-2">
                  <ng-container *ngIf="currentOperator=='isoneof' || currentOperator=='isnotoneof'; else elseTemplateofTags">
                    <!-- <mat-form-field class="example-chip-list"> -->
                    <mat-chip-list #chipList aria-label="Many Filter Selection">
                      <mat-chip *ngFor="let item of isOneOfList" [selectable]="selectable" [removable]="removable"
                        selected (removed)="removeChip(item)">
                        <mat-icon matChipRemove *ngIf="removable" class="ml-0 mr-1">cancel</mat-icon>
                        {{item}}
                      </mat-chip>
                      <input placeholder="Write or select multiple..." #isOneOfInput [formControl]="isOneOfCtrl"
                        [matAutocomplete]="auto" [matChipInputFor]="chipList"
                        [matChipInputSeparatorKeyCodes]="separatorKeysCodes" [matChipInputAddOnBlur]="addOnBlur"
                        (matChipInputTokenEnd)="addChip($event)"
                        style="background-color: #fefefe; width: 100%; margin-top: 7px;padding: 6px; border-radius: 5px;">
                    </mat-chip-list>
                    <mat-autocomplete #auto="matAutocomplete" (optionSelected)="selectedChip($event)">
                      <mat-option *ngFor="let item of filteredIsOneOfs | async" [value]="item">
                        {{item}}
                      </mat-option>
                    </mat-autocomplete>
                    <!-- </mat-form-field> -->

                  </ng-container>
                  <ng-template #elseTemplateofTags>
                    <div class="input-group" style="width: auto" *ngIf="currentColumn == 'domain'">
                      <input type="text" [ngModelOptions]="{ standalone: true }" [(ngModel)]="currentInput"
                        class=" filterTags" placeholder="Domain">
                    </div>
                    <div class="input-group" style="width: auto" *ngIf="currentColumn == 'subdomain'">
                      <input type="text" name="filterValue" [ngModelOptions]="{ standalone: true }"
                        [(ngModel)]="currentInput" class="filterTags" placeholder="Subdomain">
                    </div>
                    <div class="input-group" *ngIf="currentColumn == 'category'">
                      <select class="filterTags" [(ngModel)]="currentInput" [ngModelOptions]="{ standalone: true }">
                        <option value="-1" disabled>Select A Category</option>
                        <option *ngFor="let cat of mainCategories" label="{{cat.categoryName}}"
                          value="{{cat.categoryName}}">
                          {{cat.categoryName}}
                        </option>
                      </select>
                    </div>
                    <div class="input-group" style="width: auto" *ngIf="currentColumn == 'applicationName'">
                      <select class="filterTags" [(ngModel)]="currentInput" [ngModelOptions]="{ standalone: true }">
                        <option value="-1" disabled>Select An Application</option>
                        <option *ngFor="let a of mainApplications" value="{{ a.name }}">{{ a.name }}</option>
                      </select>
                    </div>
                    <div class="input-group" style="width: auto" *ngIf="currentColumn == 'action'">
                      <select class="filterTags" [(ngModel)]="currentInput" place
                        [ngModelOptions]="{ standalone: true }">
                        <option value="-1" disabled>Select An Action</option>
                        <option value="true">Allow</option>
                        <option value="false">Block</option>
                      </select>
                    </div>
                    <div class="input-group" style="width: auto"
                      *ngIf="currentColumn == 'sourceIpCountryCode' || currentColumn == 'destinationIpCountryCode'">
                      <select class="filterTags " [(ngModel)]="currentInput" place
                        [ngModelOptions]="{ standalone: true }">
                        <option value="-1" disabled>Select A Country</option>
                        <option value="00">Local Domain</option>
                        <option *ngFor="let country of countries" value="{{ country.code }}">{{ country.name }}</option>
                      </select>
                    </div>
                    <div class="input-group" style="width: auto" *ngIf="currentColumn == 'agentAlias'">
                      <select class="filterTags " [(ngModel)]="currentInput" [ngModelOptions]="{ standalone: true }">
                        <option value="-1" disabled>Select An Agent</option>
                        <option *ngFor="let agent of agents" value="{{ agent.agentAlias }}">{{ agent.agentAlias }}
                        </option>
                      </select>
                    </div>
                    <div class="input-group" style="width: auto" *ngIf="currentColumn == 'reasonType'">
                      <select class="filterTags" [(ngModel)]="currentInput" [ngModelOptions]="{ standalone: true }">
                        <option value="category">Category</option>
                        <option value="application">Application</option>
                        <option value="bwlist">BlackList/Whitelist</option>
                        <option value="noip">Noip Domain</option>
                        <option value="malformed">Malformed Query</option>
                      </select>
                    </div>
                    <div class="input-group" style="width: auto"
                      *ngIf="currentColumn == 'sourceIp' || currentColumn == 'destinationIp'">
                      <input class="filterTags" [(ngModel)]="currentInput" (click)="inputClicked($event)"
                        [ngModelOptions]="{ standalone: true }" (change)="inputsChanged($event)"
                        (keyup.enter)="inputsChanged($event)" placeholder="xxx.xxx.xxx.xxx" />
                    </div>
                    <div class="input-group" style="width: auto" *ngIf="currentColumn == 'time'">
                      <input class="filterTags"
                        value="{{currentColumn == 'time' ? (currentInput | dateFormat): currentInput}}"
                        (click)="inputClicked($event)" (change)="inputsChanged($event)"
                        (keyup.enter)="inputsChanged($event)" />
                    </div>
                    <div class="input-group" style="width: auto" *ngIf="
                            currentColumn != 'subdomain' &&    
                            currentColumn != 'domain' &&    
                            currentColumn != 'agentAlias' &&
                                currentColumn != 'action' &&
                                currentColumn != 'reasonType' &&
                                currentColumn != 'time' &&
                                currentColumn != 'applicationName' &&
                                currentColumn != 'category' &&
                                currentColumn != 'sourceIpCountryCode' &&
                                currentColumn != 'destinationIpCountryCode' &&
                                currentColumn != 'sourceIp' &&
                                currentColumn != 'destinationIp'
                              ">
                      <input class="filterTags" [(ngModel)]="currentInput" (click)="inputClicked($event)"
                        [ngModelOptions]="{ standalone: true }" (keyup.enter)="inputsChanged($event)" />
                    </div>

                  </ng-template>

                </div>
                <div class="col-12 mt-2">
                  <button class="btns btn-teritary" (click)="addTag($event)">Apply</button>
                  <button class="btns btn-clear" (click)="cancelFilterPopup()">Cancel</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-2 d-flex align-items-center">
        <div class="dropdown d-inline-block" >
          <button class="btn btn-link dropdown-toggle  circle-dropdown-btn ml-0 mr-0" type="button"
            data-toggle="dropdown" [matTooltipShowDelay]="900" matTooltip="SAVE FILTERS" aria-haspopup="true"
            aria-expanded="false">
            <i class="fa fa-floppy-o" style="font-size: 20px"></i>
          </button>
          <div class="dropdown-menu" style="width: 300px">
            <div class="container-fluid">
              <div class="row">
                <div class="col-12">
                  <input type="text" class="form-control reverse-form" placeholder="Give a name"
                    [(ngModel)]="newSavedReportName">
                </div>
                <div class="col-12 mt-2">
                  <button class="btn btn-success" (click)="saveReportFilters()">
                    <i class="fa fa-check-circle-o"></i>
                    Save
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
        <button class="btn btn-teritary ml-2" style="width: 164px;" (click)="search()">
          Search
        </button>
      </div>
    </div>
  </div>
</div>



<!-- <div class="container-fluid col-md-12">
  <div class="row">
    <form class="form-horizontal card">
      <div class="col-md-12">
        <div class="row mt-2 mb-2">
          <div class="col-md-1 text-right" style="max-width: 100px;">
            <label class="col-form-label">AND</label>
          </div>
          <div class="col-md-11" style="margin-left: -30px;">
            <app-column-tag-input [columns]="columns" [tags]="searchSetting.must" #must
              [mainCategories]="mainCategories" [agents]="agents" [zoneName]="must"
              [mainApplications]="mainApplications" [applicationsMap]="applicationsMap"></app-column-tag-input>
          </div>
        </div>
        <div class="row mt-2 mb-2">
          <div class="col-md-1 text-right" style="max-width: 100px;">
            <label class="col-form-label">AND NOT</label>
          </div>
          <div class="col-md-11" style="margin-left: -30px;">
            <app-column-tag-input [columns]="columns" [tags]="searchSetting.mustnot" #mustNot
              [mainCategories]="mainCategories" [agents]="agents" [zoneName]="mustNot"
              [mainApplications]="mainApplications" [applicationsMap]="applicationsMap"></app-column-tag-input>
          </div>
        </div>
        <div class="row mt-2 mb-2">
          <div class="col-md-1 text-right" style="max-width: 100px;">
            <label class="col-form-label">OR</label>
          </div>
          <div class="col-md-11" style="margin-left: -30px;">
            <app-column-tag-input [columns]="columns" [tags]="searchSetting.should" #should
              [mainCategories]="mainCategories" [agents]="agents" [zoneName]="should"
              [mainApplications]="mainApplications" [applicationsMap]="applicationsMap"></app-column-tag-input>
          </div>
        </div>
        <div class="row mt-4 mb-2">
          <div class="col-md-4">
            <input type="text" class="form-control" [(ngModel)]="searchSetting.query"
              [ngModelOptions]="{ standalone: true }" [attr.placeholder]="'Query'" (keyup.enter)="search()" />
          </div>
          <div class="col-md-4">
            <select name="dateInterval" class="form-control input-xs nopadding" id="dateInterval" #dateSelect
              [(ngModel)]="searchSetting.dateInterval" (click)="showDatePanel($event)" style="font-size: 10px;">
              <option value="5">Last 5 minutes</option>
              <option value="10">Last 10 minutes</option>
              <option value="15">Last 15 minutes</option>
              <option value="30">Last 30 minutes</option>
              <option value="60">Last 1 hour</option>
              <option value="120">Last 2 hours</option>
              <option value="180">Last 3 hours</option>
              <option value="360">Last 6 hours</option>
              <option value="720">Last 12 hours</option>
              <option value="1440">Last 1 day</option>
              <option value="2880">Last 2 days</option>
              <option value="10080">Last 1 week</option>
              <option value="43200">Last 1 month</option>
              <option value="-1" #customdaterange>Custom Range</option>
            </select>
            <div #actualTarget></div>
          </div>
          <div class="col-md-2">
            <select class="form-control input-xs nopadding" name="type" id="type" [(ngModel)]="searchSetting.type">
              <option selected="true" value="roksit">Dns</option>
              <option value="roksitblock">Block Page</option>
            </select>
          </div>
          <div class="col-md-2">
            <span class="criteria-search-button">
              <button class="btn btn-primary btn-sm" (click)="search()">Search&nbsp; <i class="fa fa-search"></i>
              </button>
            </span>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6 mr-auto ml-auto">
            <p-overlayPanel id="dateDialog" class="date-overlay-panel card" #dateOverlay [dismissable]="false"
              [showCloseIcon]="false">
              <div class="row form-group">
                <div class="col-md-3">
                  <label class="control-label">Begining Date</label></div>
                <div class="col-md-8">
                  <span class="has-feedback" style="margin-bottom: 5px;padding-right: 0px">
                    <input class="form-control input-xs" name="startDate" #startDateCal />
                  </span>
                </div>
                <div class="col-md-1">
                  <button class="btn btn-danger btn-sm btn-just-icon">
                    <i class="material-icons">close</i>
                  </button>
                </div>
              </div>
              <div class="row form-group">
                <div class="col-md-3"><label class="control-label">Ending Date</label></div>
                <div class="col-md-8"><span class="has-feedback" style="padding-right: 0px">
                    <input type="text" class="form-control input-xs " name="endDate" #endDateCal />
                  </span></div>
                <div class="col-md-1"> <span class="pull-left" style="padding-left: 0px">
                    <button class="btn btn-danger btn-sm  btn-just-icon">
                      <i class="material-icons">close</i>
                    </button>
                  </span>
                </div>
              </div>
              <div class="row form-group">
                <div class="col-md-12 text-right">
                  <button class="btn btn-warning btn-sm" aria-hidden="true" (click)="hideDatePopover()">OK</button>
                </div>
              </div>
            </p-overlayPanel>
          </div>
        </div>
      </div>
    </form>
  </div>

</div> -->